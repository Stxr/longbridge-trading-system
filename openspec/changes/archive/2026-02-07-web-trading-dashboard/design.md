## 背景

目前，Longbridge 交易系统是一个基于 CLI 的工具。虽然功能强大，但缺乏直观的回测结果可视化（K 线图、权益曲线）和实时监控功能。本次变更引入 Web 面板，为策略配置、回测可视化和实盘监控提供图形化界面。

## 目标 / 非目标

**目标：**
- 提供可视化界面，用于运行回测并在 K 线图上查看结果。
- 支持实时监控实盘交易状态（余额、持仓、订单）。
- 通过 Web UI 简化数据管理流程。
- 保持无缝的开发者体验，支持通过 `lbt web` 一键启动面板。

**非目标：**
- 实现多用户鉴权系统（面板仅供本地/私人使用）。
- 取代 CLI；Web 面板是一个可选的补充界面。
- 在第一版中支持移动端浏览器。

## 技术决策

### 1. 后端框架：Express.js
- **Rationale**: Express 轻量、成熟，且对 TypeScript 有极佳支持。非常适合将现有的核心逻辑（回测引擎、数据管理器）封装为 RESTful 和 WebSocket 接口。
- **备选方案**: 曾考虑使用 Fastify 以追求更高性能，但考虑到 Express 的生态系统和简单性，对于此类内部工具是首选。

### 2. 前端框架：React + Vite + Tailwind CSS
- **Rationale**: React 是构建复杂交互式 UI 的标准。Vite 提供了极快的开发循环，Tailwind CSS 则支持快速、一致的样式开发。
- **备选方案**: 曾考虑使用 Next.js，但由于该面板是单用户本地工具，由 Express 后端托管的客户端 SPA 部署起来更简单。

### 3. 可视化库：Lightweight Charts
- **Rationale**: TradingView 开发的 `lightweight-charts` 针对金融数据进行了深度优化，能提供专业级的 K 线图和标记功能。
- **备选方案**: 曾考虑 Chart.js 或 D3.js，但要达到同等的金融图表功能需要投入大量精力。

### 4. 实时通信：WebSocket (Socket.io)
- **Rationale**: Socket.io 提供了对 WebSockets 的稳健抽象，支持自动重连，非常适合流式传输实时行情和交易更新。
- **备选方案**: 曾考虑 Server-Sent Events (SSE) 进行单向更新，但未来可能需要双向通信来进行手动交易干预。

### 5. 部署模式：“CLI 嵌入式”
- **Rationale**: `lbt web` 命令将启动 Express 服务器，并直接托管预构建的 React 前端静态文件。这确保了单一的命令行入口，方便安装使用。

## 风险 / 权衡

- **[风险] 回测数据量过大** → [规避] 在 API 中实现数据抽样或分页，避免前端图表渲染压力过大。
- **[风险] 端口冲突（默认 3000）** → [规避] 支持通过环境变量或 CLI 参数（如 `lbt web --port 8080`）配置端口。
- **[风险] UI 状态与核心引擎同步** → [规避] 在 React 中使用集中式状态管理（如 Context API 或 Zustand），确保数据一致性。
