# Longbridge Trading System (é•¿æ¡¥è¯åˆ¸è‡ªåŠ¨åŒ–äº¤æ˜“ç³»ç»Ÿ) ğŸ§§

è¿™æ˜¯ä¸€ä¸ªåŸºäº [Longport SDK](https://open.longportapp.com/docs) å¼€å‘çš„è‡ªåŠ¨åŒ–äº¤æ˜“æ¡†æ¶ï¼Œé‡‡ç”¨ TypeScript ç¼–å†™ï¼Œæ”¯æŒå¤šç­–ç•¥å¹¶è¡Œã€å›æµ‹å¼•æ“ä»¥åŠå®ç›˜äº¤æ˜“æ¨¡å¼ã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

- **æ•°æ®æŒä¹…åŒ–ä¸æ·±åº¦åŒæ­¥**ï¼šæ”¯æŒä»é•¿æ¡¥ API æ·±åº¦æ‹‰å–æµ·é‡å†å² K çº¿ï¼Œå¹¶åˆ©ç”¨ SQLite è¿›è¡Œæœ¬åœ°æŒä¹…åŒ–å­˜å‚¨ã€‚
- **ä¸“ä¸šçº§å›æµ‹å¼•æ“**ï¼š
  - æ”¯æŒ **DB å›æµ‹**ï¼ˆç§’çº§åŠ è½½æœ¬åœ°æ•°æ®ï¼‰ä¸ **å®æ—¶å›æµ‹**ï¼ˆæ‹‰å–æœ€æ–°è¡Œæƒ…ï¼‰ã€‚
  - å†…ç½®çœŸå®çš„ **èƒœç‡ (Win Rate)** ä¸ **åŠ¨æ€å¹´åŒ–å¤æ™®æ¯”ç‡ (Sharpe Ratio)** è®¡ç®—ã€‚
  - æ”¯æŒæ»‘ç‚¹å®¹å·®ã€ä½£é‡‘å»ºæ¨¡ä¸ FIFO è®¢å•æ’®åˆã€‚
- **å¤šç­–ç•¥æ¡†æ¶**ï¼šå†…ç½®é«˜ä½ç‚¹å›å½’ã€å‡çº¿äº¤å‰ã€å¸ƒæ—å¸¦ã€RSIã€MACDã€Dual Thrust ç­‰å¤šç§ç»å…¸ç­–ç•¥ã€‚
- **å®ç›˜/ä»¿çœŸæ”¯æŒ**ï¼šå¯¹æ¥é•¿æ¡¥è¯åˆ¸ OpenAPIï¼Œæ”¯æŒå®æ—¶è¡Œæƒ…è®¢é˜…ä¸è®¢å•ä¸‹è¾¾ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
npm install
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼Œå¹¶å¡«å†™æ‚¨çš„é•¿æ¡¥è¯åˆ¸ API é…ç½®ï¼š

```env
LONGPORT_APP_KEY=your_app_key
LONGPORT_APP_SECRET=your_app_secret
LONGPORT_ACCESS_TOKEN=your_access_token
```

## ğŸ“Š å‘½ä»¤è¡Œå·¥å…· (lbt CLI)

æœ¬ç³»ç»Ÿæä¾›äº†ä¸€ä¸ªåä¸º `lbt` çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæå¤§åœ°ç®€åŒ–äº†æ—¥å¸¸æ“ä½œã€‚

### 1. å®‰è£…ä¸åˆå§‹åŒ–

é¦–å…ˆç¡®ä¿å·²å®‰è£…é¡¹ç›®ä¾èµ–ï¼Œç„¶åæ‰§è¡Œ link å‘½ä»¤ï¼š

```bash
npm install
npm link
```

### 2. å¯ç”¨è‡ªåŠ¨è¡¥å…¨ (é‡è¦)

`lbt` æ”¯æŒå¼ºå¤§çš„ Shell è‡ªåŠ¨è¡¥å…¨ï¼ˆBash, Zsh, Fishï¼‰ã€‚

**Bash/Zsh ç”¨æˆ·**ï¼š
è¿è¡Œä»¥ä¸‹å‘½ä»¤å¹¶æŒ‰ç…§æç¤ºæ“ä½œï¼š
```bash
lbt --completion
```

**Fish ç”¨æˆ·**ï¼š
è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥è‡ªåŠ¨å®‰è£…è¡¥å…¨è„šæœ¬ï¼š
```fish
mkdir -p ~/.config/fish/completions
lbt --completion-fish > ~/.config/fish/completions/lbt.fish
```
*æ³¨ï¼šé‡å¯ç»ˆç«¯æˆ–è¿è¡Œ `source ~/.config/fish/config.fish` åç”Ÿæ•ˆã€‚*

### 3. å¸¸ç”¨å‘½ä»¤

- **åˆ—å‡ºç­–ç•¥**ï¼š`lbt list`
- **åŒæ­¥æ•°æ®**ï¼š`lbt sync 700.HK 1000 1m`
- **å›æµ‹ç­–ç•¥**ï¼š`lbt backtest` (ä¸å¸¦å‚æ•°å°†è¿›å…¥äº¤äº’æ¨¡å¼)
- **å®ç›˜äº¤æ˜“**ï¼š`lbt live` (åŒ…å«é£é™©ç¡®è®¤)

## ğŸ§ª å›æµ‹è¿è¡Œ

æœ¬ç³»ç»Ÿæä¾›ä¸¤ç§å›æµ‹æ¨¡å¼ï¼Œä»¥å¹³è¡¡é€Ÿåº¦ä¸å®æ—¶æ€§ã€‚

### 1. æœ¬åœ°æ•°æ®åº“å›æµ‹ (æ¨è)
é€‚ç”¨äºå¤§è§„æ¨¡å‚æ•°ä¼˜åŒ–ï¼Œç›´æ¥è¯»å–æœ¬åœ° SQLite æ•°æ®ï¼Œé€Ÿåº¦æå¿«ã€‚
```bash
npx ts-node src/test-db-backtest.ts
```
*æ³¨ï¼šè¿è¡Œå‰è¯·ç¡®ä¿å·²ä½¿ç”¨åŒæ­¥å·¥å…·ä¸‹è½½äº†å¯¹åº”è‚¡ç¥¨çš„æ•°æ®ã€‚*

### 2. API å®æ—¶å›æµ‹
ç›´æ¥ä»é•¿æ¡¥ API æ‹‰å–æœ€è¿‘ N æ¡æ•°æ®è¿›è¡Œå›æµ‹ï¼Œæ— éœ€æå‰åŒæ­¥ã€‚
```bash
npx ts-node src/test-real-backtest.ts
```

### 3. æŸ¥çœ‹æ•°æ®ç»Ÿè®¡
å¿«é€ŸæŸ¥çœ‹æœ¬åœ°æ•°æ®åº“ä¸­å·²å­˜æ•°æ®çš„èŒƒå›´å’Œæ•°é‡ï¼š
```bash
npx ts-node src/check-db.ts
```

## ğŸ“‚ é¡¹ç›®ç»“æ„

- `src/modules/strategy-framework/`: äº¤æ˜“ç­–ç•¥å®ç°æ ¸å¿ƒã€‚
- `src/modules/backtesting-engine/`: å›æµ‹å¼•æ“ï¼ŒåŒ…å«è®¢å•æ¨¡æ‹Ÿã€æ’®åˆä¸å·¥å‚ç±»ã€‚
- `src/modules/data-management/`: æ•°æ®åº“å­˜å‚¨ (DataManager)ã€æ·±åº¦åŒæ­¥å™¨ (DataSyncer)ã€‚
- `src/modules/performance-analytics/`: æ€§èƒ½æŒ‡æ ‡è®¡ç®—ï¼ˆæ”¶ç›Šç‡ã€å›æ’¤ã€èƒœç‡ã€å¤æ™®æ¯”ç‡ï¼‰ã€‚
- `src/modules/longbridge-integration/`: é•¿æ¡¥ SDK å°è£…ã€‚

## ğŸ›  å¼€å‘æ‰©å±•

æ‚¨å¯ä»¥ç»§æ‰¿ `src/modules/strategy-framework/base-strategy.ts` å¹¶å®ç° `onData` æ–¹æ³•ã€‚ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç† symbol åŒ¹é…ä¸æ•°æ®åˆ†å‘ã€‚

```typescript
export class MyStrategy extends BaseStrategy {
  async onData(kline: KLine): Promise<void> {
    // æ‚¨çš„é€»è¾‘
  }
}
```

## ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®é‡‡ç”¨ ISC åè®®ã€‚

---

*ç¥è€æ¿ï¼šæ‹›è´¢è¿›å®ï¼Œä»£ç é›¶ Bugï¼* ğŸ§§